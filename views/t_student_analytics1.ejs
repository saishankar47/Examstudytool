<!DOCTYPE html>
<html lang="en">
  <%- include('t_head.ejs') %>
<body>
    <style>
        body{
          background-image: linear-gradient(45deg, #93a5cf 0%, #e4efe9 100%);
          
        }
  
      </style>
      
      <style>
        .score-container {
            margin-top: 30px;
            padding: 20px;
            border: 1px solid #999;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
        
        .score-title {
            margin-bottom: 10px;
            font-size: 24px;
            color: #333;
        }
        
        .score-value {
            font-size: 30px;
            font-weight: bold;
            color: #007bff;
        }
        .percentage-container {
            margin-bottom: 10px;
            font-size: 24px;
            color: #333;
        }
        
        .percentage-value {
            font-size: 30px;
            font-weight: bold;
            color: #007bff;
        }

        
        #startTestBtn {
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 50px;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
        }

        #startTestBtn:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }

        #timerDisplay {
            font-size: 20px;
            font-weight: bold;
            color: #dc3545;
            justify-content: center; 
        }
        
        #timerWrapper {
            display: none;
            border: 1px solid #000;
            border-radius: 50px;
            padding: 5px 15px;
            background-color: white;
            border-color: white;
        }

        .button-row {
            display: flex;
            align-items: center;
            padding-bottom: 20px;
        }
        
        .correct {
            color: #155724;
            background: #d4edda;
            border: 1px solid #c3e6cb;
            position: relative;
        }
        .correct::before {
            content: '✔';
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
        }
        .wrong {
            color: #721c24;
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            position: relative;
        }
        .wrong::before {
            content: '✖';
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
        }

        #timerdatadiv {
        display: none;
    }

    #timersubmitdiv{
        display: none;
    }

    #emptydiv{
        display: block;
    }


    </style>
       <link href="/css/s_learning_archive.css" rel="stylesheet">
<header>

    <nav class="navbar navbar-expand-md navbar-light fixed-top bg-light">
        <div class="container-fluid">
            <a class="navbar-brand" href="/teacher">Exam Study Tool</a>

            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse"
                aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" style="border-left: 1px solid darkgray; " id="navbarCollapse">
                <ul class="navbar-nav me-auto mb-2 mb-sm-0">
                    <li class="nav-item">
                        <a class="nav-link" style="padding-left: 15px;color: blue;" aria-current="page" href="/teacher">Class</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link " style="padding-left: 15px;" aria-current="page" href="/teacher/questions">Questions</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/teacher/status" >Status</a>
                    </li>
                </ul>
            </div>
            <div class="collapse navbar-collapse" id="navbarCollapse">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" aria-current="page" href="/teacher/profile"><i
                                style="padding-right: 4px;" class="fa fa-user"></i><%= user.user_name %></a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/">LOGOUT</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <br>
</header>
<script>
    $(document).ready(function () {
     
         $('#example1').dataTable({
            order: [[0, 'asc']],
        });
        
    });
</script>
<div class="row">
    <div class="col">
        <div class="col">
            <!-- http://localhost/teacher/student/analytics?class_id=2&class_name=class%20B&user_name=Subhasri&student_id=16 -->
            <a href="/teacher/student/analytics?class_id=<%=class_id%>&class_name=<%=class_name%>&user_name=<%=user_name%>&student_id=<%=user_id%>" >  <button class="btn btn-dark"; type="button" >
              <i class="fa fa-arrow-left"> </i>
            </button>
            </a>
        </div>
            <div class="col-12"><h4 style="text-align: center;">"<%=user_name%> Analytics in <%=test_name%>" </h4></div>
    </div>
</div>
  <style>
    hr.dotted {
      border-top: 3px dotted #bbb;
    }
</style>  
<hr class="dotted"> 
  <br><br>

    <div class="container-xl">
    <div class="row">
        <div class="col shadow p-3 mb-5 bg-white rounded">
          
        
            <br>
            <div class="col-12 text-center border-bottom fw-bold" style="padding-bottom: 10px;">
              <p>Questions</p>
          </div>
          <% for (let i=0; i < data0.length; i++){ %>
              <div class="row border-bottom">
                  <div class="col-6 border-end">
                      <div class="row" style="padding: 10px;">
                          <p id="newline">
                              <%= i+1 %>. <%- data0[i].question ? data0[i].question.replace('<p>', '') : data0[i].question %>
                                  <% if (data0[i].question_url && data0[i].question_url.trim() !== '') { %>
                                  <div>
                                      <img src="<%= data0[i].question_url %>" class="img-fluid" alt="">
                                  </div>
                              <% } %>
                          </p>
                          <div>
                              <input type="radio">
                              <input type="radio">
                              <input type="radio">
                              <input type="radio">
                              <label for="one<%= i %>" class="box boxd first">
                                  <div class="course">
                                      <span class="circle"></span>
                                      <span class="subject">A. <%- data0[i].option_1 ? data0[i].option_1.replace('<p>', '') : data0[i].option_1 %>
                                          <% if (data0[i].option_1_url && data0[i].option_1_url.trim() !== '') { %>
                                              <div>
                                                  <img src="<%= data0[i].option_1_url %>" class="img-fluid" alt="">
                                              </div>
                                          <% } %>
                                      </span>
                                  </div>
                              </label>
                              <label for="two<%= i %>" class="box boxd second">
                                  <div class="course">
                                      <span class="circle"></span>
                                      <span class="subject">B. <%- data0[i].option_2 ? data0[i].option_2.replace('<p>', '') : data0[i].option_2 %>
                                          <% if (data0[i].option_2_url && data0[i].option_2_url.trim() !== '') { %>
                                              <div>
                                                  <img src="<%= data0[i].option_2_url %>" class="img-fluid" alt="">
                                              </div>
                                          <% } %>
                                      </span>
                                  </div>
                              </label>
                              <label for="three<%= i %>" class="box boxd third">
                                  <div class="course">
                                      <span class="circle"></span>
                                      <span class="subject">C. <%- data0[i].option_3 ? data0[i].option_3.replace('<p>', '') : data0[i].option_3 %>
                                          <% if (data0[i].option_3_url && data0[i].option_3_url.trim() !== '') { %>
                                              <div>
                                                  <img src="<%= data0[i].option_3_url %>" class="img-fluid" alt="">
                                              </div>
                                          <% } %>
                                      </span>
                                  </div>
                              </label>
                              <label for="four<%= i %>" class="box boxd forth">
                                  <div class="course">
                                      <span class="circle"></span>
                                      <span class="subject">D. <%- data0[i].option_4 ? data0[i].option_4.replace('<p>', '') : data0[i].option_4 %>
                                          <% if (data0[i].option_4_url && data0[i].option_4_url.trim() !== '') { %>
                                              <div>
                                                  <img src="<%= data0[i].option_4_url %>" class="img-fluid" alt="">
                                              </div>
                                          <% } %>
                                      </span>
                                  </div>
                              </label>
                          </div>
                      </div>
                  </div>
  
                  <div class="col-6">
                      <% if (data0[i].translation_id!=null){ %>
                          <div class="row" dir="<%= data0[i].language === 'Arabic' ? 'rtl' : 'ltr' %>" lang="<%= data0[i].language %>"  style="padding: 10px;">
                              <% if (data0[i].language === 'Arabic') { %>
                                  <p>
                                      <%= i+1 %>. <%- data0[i].t_question ? data0[i].t_question.replace('<p>', '') : data0[i].t_question %>
                                          <% if (data0[i].t_question_url && data0[i].t_question_url.trim() !== '') { %>
                                          <div>
                                              <img src="<%= data0[i].t_question_url %>" class="img-fluid" alt="">
                                          </div>
                                      <% } %>
                                  </p>
                                  <div>
                                      <% if (saved[i][1] == 'option_1') { %>
                                          <input type="radio" name="box<%= i %>" id="t_one<%= i %>"
                                          value="option_1" data-answer="<%= data0[i].answer %>" data-question-id="<%= data0[i].question_id %>" checked="checked" disabled>
                                      <% } else { %>
                                          <input type="radio" name="box<%= i %>" id="t_one<%= i %>"
                                          value="option_1" data-answer="<%= data0[i].answer %>" data-question-id="<%= data0[i].question_id %>" disabled>
                                      <% } %>
                                      <% if (saved[i][1] == 'option_2') { %>
                                          <input type="radio" name="box<%= i %>" id="t_two<%= i %>"
                                          value="option_2" data-answer="<%= data0[i].answer %>" data-question-id="<%= data0[i].question_id %>" checked="checked" disabled>
                                      <% } else { %>
                                          <input type="radio" name="box<%= i %>" id="t_two<%= i %>"
                                          value="option_2" data-answer="<%= data0[i].answer %>" data-question-id="<%= data0[i].question_id %>" disabled>
                                      <% } %>
                                      <% if (saved[i][1] == 'option_3') { %>
                                          <input type="radio" name="box<%= i %>" id="t_three<%= i %>"
                                          value="option_3" data-answer="<%= data0[i].answer %>" data-question-id="<%= data0[i].question_id %>" checked="checked" disabled>
                                      <% } else { %>
                                          <input type="radio" name="box<%= i %>" id="t_three<%= i %>"
                                          value="option_3" data-answer="<%= data0[i].answer %>" data-question-id="<%= data0[i].question_id %>" disabled>
                                      <% } %>
                                      <% if (saved[i][1] == 'option_4') { %>
                                          <input type="radio" name="box<%= i %>" id="t_four<%= i %>"
                                          value="option_4" data-answer="<%= data0[i].answer %>" data-question-id="<%= data0[i].question_id %>" checked="checked" disabled>
                                      <% } else { %>
                                          <input type="radio" name="box<%= i %>" id="t_four<%= i %>"
                                          value="option_4" data-answer="<%= data0[i].answer %>" data-question-id="<%= data0[i].question_id %>" disabled>
                                      <% } %>
                                      <label for="t_one<%= i %>" class="box boxh t_first">
                                          <div class="course">
                                              <span class="circle"></span>
                                              <span class="subject">A. <%- data0[i].t_option_1 ? data0[i].t_option_1.replace('<p>', '') : data0[i].t_option_1 %>
                                                  <% if (data0[i].t_option_1_url && data0[i].t_option_1_url.trim() !== '') { %>
                                                      <div>
                                                          <img src="<%= data0[i].t_option_1_url %>" class="img-fluid" alt="">
                                                      </div>
                                                  <% } %>
                                              </span>
                                          </div>
                                      </label>
                                      <label for="t_two<%= i %>" class="box boxh t_second">
                                          <div class="course">
                                              <span class="circle"></span>
                                              <span class="subject">B. <%- data0[i].t_option_2 ? data0[i].t_option_2.replace('<p>', '') : data0[i].t_option_2 %>
                                                  <% if (data0[i].t_option_2_url && data0[i].t_option_2_url.trim() !== '') { %>
                                                      <div>
                                                          <img src="<%= data0[i].t_option_2_url %>" class="img-fluid" alt="">
                                                      </div>
                                                  <% } %>
                                              </span>
                                          </div>
                                      </label>
                                      <label for="t_three<%= i %>" class="box boxh t_third">
                                          <div class="course">
                                              <span class="circle"></span>
                                              <span class="subject">C. <%- data0[i].t_option_3 ? data0[i].t_option_3.replace('<p>', '') : data0[i].t_option_3 %>
                                                  <% if (data0[i].t_option_3_url && data0[i].t_option_3_url.trim() !== '') { %>
                                                      <div>
                                                          <img src="<%= data0[i].t_option_3_url %>" class="img-fluid" alt="">
                                                      </div>
                                                  <% } %>
                                              </span>
                                          </div>
                                      </label>
                                      <label for="t_four<%= i %>" class="box boxh t_forth">
                                          <div class="course">
                                              <span class="circle"></span>
                                              <span class="subject">D. <%- data0[i].t_option_4 ? data0[i].t_option_4.replace('<p>', '') : data0[i].t_option_4 %>
                                                  <% if (data0[i].t_option_4_url && data0[i].t_option_4_url.trim() !== '') { %>
                                                      <div>
                                                          <img src="<%= data0[i].t_option_4_url %>" class="img-fluid" alt="">
                                                      </div>
                                                  <% } %>
                                              </span>
                                          </div>
                                      </label>
                                  </div>                                              
                                  <% } else { %>
                                  <p>
                                      <%= i+1 %>. <%- data0[i].t_question ? data0[i].t_question.replace('<p>', '') : data0[i].t_question %>
                                          <% if (data0[i].t_question_url && data0[i].t_question_url.trim() !== '') { %>
                                          <div>
                                              <img src="<%= data0[i].t_question_url %>" class="img-fluid" alt="">
                                          </div>
                                      <% } %>
                                  </p>
                                  <div>
                                      <% if (saved[i][1] == 'option_1') { %>
                                          <input type="radio" name="box<%= i %>" id="t_one<%= i %>"
                                          value="option_1" data-answer="<%= data0[i].answer %>" data-question-id="<%= data0[i].question_id %>" checked="checked" disabled>
                                      <% } else { %>
                                          <input type="radio" name="box<%= i %>" id="t_one<%= i %>"
                                          value="option_1" data-answer="<%= data0[i].answer %>" data-question-id="<%= data0[i].question_id %>" disabled>
                                      <% } %>
                                      <% if (saved[i][1] == 'option_2') { %>
                                          <input type="radio" name="box<%= i %>" id="t_two<%= i %>"
                                          value="option_2" data-answer="<%= data0[i].answer %>" data-question-id="<%= data0[i].question_id %>" checked="checked" disabled>
                                      <% } else { %>
                                          <input type="radio" name="box<%= i %>" id="t_two<%= i %>"
                                          value="option_2" data-answer="<%= data0[i].answer %>" data-question-id="<%= data0[i].question_id %>" disabled>
                                      <% } %>
                                      <% if (saved[i][1] == 'option_3') { %>
                                          <input type="radio" name="box<%= i %>" id="t_three<%= i %>"
                                          value="option_3" data-answer="<%= data0[i].answer %>" data-question-id="<%= data0[i].question_id %>" checked="checked" disabled>
                                      <% } else { %>
                                          <input type="radio" name="box<%= i %>" id="t_three<%= i %>"
                                          value="option_3" data-answer="<%= data0[i].answer %>" data-question-id="<%= data0[i].question_id %>" disabled>
                                      <% } %>
                                      <% if (saved[i][1] == 'option_4') { %>
                                          <input type="radio" name="box<%= i %>" id="t_four<%= i %>"
                                          value="option_4" data-answer="<%= data0[i].answer %>" data-question-id="<%= data0[i].question_id %>" checked="checked" disabled>
                                      <% } else { %>
                                          <input type="radio" name="box<%= i %>" id="t_four<%= i %>"
                                          value="option_4" data-answer="<%= data0[i].answer %>" data-question-id="<%= data0[i].question_id %>" disabled>
                                      <% } %>
                                      <label for="t_one<%= i %>" class="box boxh t_first">
                                          <div class="course">
                                              <span class="circle"></span>
                                              <span class="subject">A. <%- data0[i].t_option_1 ? data0[i].t_option_1.replace('<p>', '') : data0[i].t_option_1 %>
                                                  <% if (data0[i].t_option_1_url && data0[i].t_option_1_url.trim() !== '') { %>
                                                      <div>
                                                          <img src="<%= data0[i].t_option_1_url %>" class="img-fluid" alt="">
                                                      </div>
                                                  <% } %>
                                              </span>
                                          </div>
                                      </label>
                                      <label for="t_two<%= i %>" class="box boxh t_second">
                                          <div class="course">
                                              <span class="circle"></span>
                                              <span class="subject">B. <%- data0[i].t_option_2 ? data0[i].t_option_2.replace('<p>', '') : data0[i].t_option_2 %>
                                                  <% if (data0[i].t_option_2_url && data0[i].t_option_2_url.trim() !== '') { %>
                                                      <div>
                                                          <img src="<%= data0[i].t_option_2_url %>" class="img-fluid" alt="">
                                                      </div>
                                                  <% } %>
                                              </span>
                                          </div>
                                      </label>
                                      <label for="t_three<%= i %>" class="box boxh t_third">
                                          <div class="course">
                                              <span class="circle"></span>
                                              <span class="subject">C. <%- data0[i].t_option_3 ? data0[i].t_option_3.replace('<p>', '') : data0[i].t_option_3 %>
                                                  <% if (data0[i].t_option_3_url && data0[i].t_option_3_url.trim() !== '') { %>
                                                      <div>
                                                          <img src="<%= data0[i].t_option_3_url %>" class="img-fluid" alt="">
                                                      </div>
                                                  <% } %>
                                              </span>
                                          </div>
                                      </label>
                                      <label for="t_four<%= i %>" class="box boxh t_forth">
                                          <div class="course">
                                              <span class="circle"></span>
                                              <span class="subject">D. <%- data0[i].t_option_4 ? data0[i].t_option_4.replace('<p>', '') : data0[i].t_option_4 %>
                                                  <% if (data0[i].t_option_4_url && data0[i].t_option_4_url.trim() !== '') { %>
                                                      <div>
                                                          <img src="<%= data0[i].t_option_4_url %>" class="img-fluid" alt="">
                                                      </div>
                                                  <% } %>
                                              </span>
                                          </div>
                                      </label>
                                  </div>
                                <% } %>
                          </div>
  
                          <% } else { %>
                              <div class="row" style="padding: 10px;">
                                  <p>
                                      <%= i+1 %>. <%- data0[i].question ? data0[i].question.replace('<p>', '') : data0[i].question %>
                                          <% if (data0[i].question_url && data0[i].question_url.trim() !== '') { %>
                                          <div>
                                              <img src="<%= data0[i].question_url %>" class="img-fluid" alt="">
                                          </div>
                                      <% } %>
                                  </p>
                                  <div>
                                      <% if (saved[i][1] == 'option_1') { %>
                                          <input type="radio" name="box<%= i %>" id="t_one<%= i %>"
                                          value="option_1" data-answer="<%= data0[i].answer %>" data-question-id="<%= data0[i].question_id %>" checked="checked" disabled>
                                      <% } else { %>
                                          <input type="radio" name="box<%= i %>" id="t_one<%= i %>"
                                          value="option_1" data-answer="<%= data0[i].answer %>" data-question-id="<%= data0[i].question_id %>" disabled>
                                      <% } %>
                                      <% if (saved[i][1] == 'option_2') { %>
                                          <input type="radio" name="box<%= i %>" id="t_two<%= i %>"
                                          value="option_2" data-answer="<%= data0[i].answer %>" data-question-id="<%= data0[i].question_id %>" checked="checked" disabled>
                                      <% } else { %>
                                          <input type="radio" name="box<%= i %>" id="t_two<%= i %>"
                                          value="option_2" data-answer="<%= data0[i].answer %>" data-question-id="<%= data0[i].question_id %>" disabled>
                                      <% } %>
                                      <% if (saved[i][1] == 'option_3') { %>
                                          <input type="radio" name="box<%= i %>" id="t_three<%= i %>"
                                          value="option_3" data-answer="<%= data0[i].answer %>" data-question-id="<%= data0[i].question_id %>" checked="checked" disabled>
                                      <% } else { %>
                                          <input type="radio" name="box<%= i %>" id="t_three<%= i %>"
                                          value="option_3" data-answer="<%= data0[i].answer %>" data-question-id="<%= data0[i].question_id %>" disabled>
                                      <% } %>
                                      <% if (saved[i][1] == 'option_4') { %>
                                          <input type="radio" name="box<%= i %>" id="t_four<%= i %>"
                                          value="option_4" data-answer="<%= data0[i].answer %>" data-question-id="<%= data0[i].question_id %>" checked="checked" disabled>
                                      <% } else { %>
                                          <input type="radio" name="box<%= i %>" id="t_four<%= i %>"
                                          value="option_4" data-answer="<%= data0[i].answer %>" data-question-id="<%= data0[i].question_id %>" disabled>
                                      <% } %>
  
  
                                      <label for="t_one<%= i %>" class="box boxh t_first">
                                          <div class="course">
                                              <span class="circle"></span>
                                              <span class="subject">A. <%- data0[i].option_1 ? data0[i].option_1.replace('<p>', '') : data0[i].option_1 %>
                                                  <% if (data0[i].option_1_url && data0[i].option_1_url.trim() !== '') { %>
                                                      <div>
                                                          <img src="<%= data0[i].option_1_url %>" class="img-fluid" alt="">
                                                      </div>
                                                  <% } %>
                                              </span>
                                          </div>
                                      </label>
                                      <label for="t_two<%= i %>" class="box boxh t_second">
                                          <div class="course">
                                              <span class="circle"></span>
                                              <span class="subject">B. <%- data0[i].option_2 ? data0[i].option_2.replace('<p>', '') : data0[i].option_2 %>
                                                  <% if (data0[i].option_2_url && data0[i].option_2_url.trim() !== '') { %>
                                                      <div>
                                                          <img src="<%= data0[i].option_2_url %>" class="img-fluid" alt="">
                                                      </div>
                                                  <% } %>
                                              </span>
                                          </div>
                                      </label>
                                      <label for="t_three<%= i %>" class="box boxh t_third">
                                          <div class="course">
                                              <span class="circle"></span>
                                              <span class="subject">C. <%- data0[i].option_3 ? data0[i].option_3.replace('<p>', '') : data0[i].option_3 %>
                                                  <% if (data0[i].option_3_url && data0[i].option_3_url.trim() !== '') { %>
                                                      <div>
                                                          <img src="<%= data0[i].option_3_url %>" class="img-fluid" alt="">
                                                      </div>
                                                  <% } %>
                                              </span>
                                          </div>
                                      </label>
                                      <label for="t_four<%= i %>" class="box boxh t_forth">
                                          <div class="course">
                                              <span class="circle"></span>
                                              <span class="subject">D. <%- data0[i].option_4 ? data0[i].option_4.replace('<p>', '') : data0[i].option_4 %>
                                                  <% if (data0[i].option_4_url && data0[i].option_4_url.trim() !== '') { %>
                                                      <div>
                                                          <img src="<%= data0[i].option_4_url %>" class="img-fluid" alt="">
                                                      </div>
                                                  <% } %>
                                              </span>
                                          </div>
                                      </label>
                                  </div>
  
                              </div>
                              <% } %>
                  </div>
              </div>
              
              <% } %>
              <div class="col-12 border-top" id="show" style="padding-top: 20px; padding-bottom: 20px;">
                  <div class="d-flex justify-content-center">
                      <button class="btn btn-warning px-4 py-2 fw-bold" onclick="ShowAndHide()">Show
                          Solution</button>
                  </div>
              </div>
              <div class="card-body border-bottom inv" id="answer">
                  <% for (let i=0; i < data0.length; i++){ %>
                      <div class="row">
                          <div class="col-6 border-end">
                              <div style="padding-bottom: 10px;">
                                  <div>
                                      <%= i+1 %>. <%- data0[i].solution ? data0[i].solution.replace('<p>', '') : data0[i].solution %>
                                          <% if (data0[i].solution_url && data0[i].solution_url.trim() !== '') { %>
                                          <div>
                                              <img src="<%= data0[i].solution_url %>" class="img-fluid" alt="">
                                          </div>
                                      <% } %>
                                      </div>
                              </div>
                          </div>
                          <div class="col-6">
                              <div style="padding-bottom: 10px;padding-left: 20px;">
                                  <% if (data0[i].t_solution==null){ %>
                                      <div>
                                          <%= i+1 %>. <%- data0[i].solution ? data0[i].solution.replace('<p>', '') : data0[i].solution %>
                                              <% if (data0[i].solution_url && data0[i].solution_url.trim() !== '') { %>
                                              <div>
                                                  <img src="<%= data0[i].solution_url %>" class="img-fluid" alt="">
                                              </div>
                                          <% } %>
                                          </div>
                                  <% } else { %>
                                      <div dir="<%= data0[i].language === 'Arabic' ? 'rtl' : 'ltr' %>" lang="<%= data0[i].language %>">
                                          <% if (data0[i].language === 'Arabic') { %>
                                              <%= i+1 %>. <%- data0[i].t_solution ? data0[i].t_solution.replace('<p>', '') : data0[i].t_solution %>
                                                  <% if (data0[i].t_solution_url && data0[i].t_solution_url.trim() !== '') { %>
                                                  <div>
                                                      <img src="<%= data0[i].t_solution_url %>" class="img-fluid" alt="">
                                                  </div>
                                              <% } %>
                                            <% } else { %>
                                              <%= i+1 %>. <%- data0[i].t_solution ? data0[i].t_solution.replace('<p>', '') : data0[i].t_solution %>
                                                  <% if (data0[i].t_solution_url && data0[i].t_solution_url.trim() !== '') { %>
                                                  <div>
                                                      <img src="<%= data0[i].t_solution_url %>" class="img-fluid" alt="">
                                                  </div>
                                              <% } %>
                                            <% } %>
                                      </div>
                                  <% } %>
                              </div>
                          </div>
                      </div>
                      <% } %>
              </div>
          </div>
    </div>
    </div>

    
    <script>
        let timeInSeconds = `<%- JSON.stringify(data0[0].time) %>`;
        let timer;
        let testSubmitted = false;
        //let timeInSeconds = 10; // Set your desired timer duration in seconds
        let timeRemaining = timeInSeconds;
        let timed = false;
        let classid = `<%-class_id%>`;
        console.log("classid:", classid);

        function updateTimerDisplay() {
            const hours = Math.floor(timeRemaining / 3600);
            const minutes = Math.floor((timeRemaining % 3600) / 60);
            const seconds = timeRemaining % 60;
            const displayString = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            document.getElementById("timerDisplay").textContent = displayString;
        }

        function startTest() {
            document.getElementById("startTestBtn").disabled = true;
            document.getElementById("savebtn").style.display = 'none';
            document.getElementById("timerWrapper").style.display = 'block';
            document.getElementById("timerdatadiv").style.display = 'block';
            document.getElementById("timersubmitdiv").style.display = 'block';
            document.getElementById("emptydiv").style.display = 'none';
            document.getElementById("back-button").disabled = true;

            updateTimerDisplay();
            timer = setInterval(countdown, 1000);
            timed = true;
        }

        function countdown() {
            timeRemaining--;
            updateTimerDisplay();
            if (timeRemaining <= 0) {
                clearInterval(timer);
                if (!testSubmitted) {
                    submitTest();
                }
            }
        }
            function submitTest(event) {
                if (event) {
                    event.preventDefault();
                }

                testSubmitted = true;
                clearInterval(timer);
                document.getElementById("startTestBtn").disabled = true;
                document.getElementById("back-button").disabled = false;


                console.log("Test submitted"); 

                // Calculate the score
                let score = 0;
                const totalQuestions = `<%- JSON.stringify(data0.length) %>`;
                console.log(totalQuestions);
        
                for (let i = 0; i < totalQuestions; i++) {
                    let radios = document.getElementsByName('box' + i);
                    for (let j = 0; j < radios.length; j++) {
                        if (radios[j].checked && radios[j].value === radios[j].getAttribute('data-answer')) {
                            score++;
                            break;
                        }
                    }
                }

                // Calculate the percentage
                let percentage = (score / totalQuestions) * 100;

                // Display the percentage
                document.querySelector('.percentage-value').innerHTML = percentage.toFixed(2) + '%';
                document.getElementById('percentage-container').style.display = 'block';

                // Collect selected options and question IDs
                let selectedOptions = [];
                for (let i = 0; i < totalQuestions; i++) {
                    let userAnswer = document.querySelector(`input[name="box${i}"]:checked`);
                    let questionId = document.querySelector(`input[name="box${i}"]`).dataset.questionId;
                    selectedOptions.push({
                        questionId: questionId,
                        option: userAnswer ? userAnswer.value : null,
                    });
                }
                // Display the score
                document.querySelector('.score-value').innerHTML = score;
                document.getElementById('score-container').style.display = 'block';

                document.getElementById('submit').style.display = 'none';
                document.getElementById("score-container").classList.remove("d-none");

        
                // Show the answer section
                var x = document.getElementById("show");
                x.className = "vis";

                // Send data to the server
                sendDataOnSubmit(selectedOptions, score, percentage, timed);

                
                for (let i = 0; i < totalQuestions; i++) {
                    let radios = document.getElementsByName('box' + i);
                    for (let j = 0; j < radios.length; j++) {
                        radios[j].disabled = true;
                    }
                }

                // Show the test submitted modal
                var testSubmittedModal = new bootstrap.Modal(document.getElementById('testSubmittedModal'));
                testSubmittedModal.show();
            }

            function sendDataOnSubmit(selectedOptions, score, percentage, timed) {
                console.log("<%=assigned_questions_id%>");
                const serverUrl = '/student/assessment/assigned/questions/<%-JSON.stringify(data0[0].test_id)%>/<%-class_id%>/<%-assigned_questions_id%>/submit-score';
                console.log("class_id",`<%-JSON.stringify(data0[0].class_id)%>`);
                console.log("test_id",`<%-JSON.stringify(data0[0].test_id)%>`);
                
                fetch(serverUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        options: selectedOptions,
                        score: score,
                        percentage: percentage,
                        timed : timed,
                    }),
                })
                .then((response) => response.json())
                .then((data) => {
                    console.log('Success:', data);
                })
                .catch((error) => {
                    console.error('Error:', error);
                });
            }
            

        function saveTest() {
            // Prevent the form from submitting
            event.preventDefault();

            document.getElementById('startTestBtn').style.display = 'none';

            // Calculate the score
            let score = 0;
            const totalQuestions = `<%- JSON.stringify(data0.length) %>`;
            console.log(totalQuestions);
    
            for (let i = 0; i < totalQuestions; i++) {
                let radios = document.getElementsByName('box' + i);
                for (let j = 0; j < radios.length; j++) {
                    if (radios[j].checked && radios[j].value === radios[j].getAttribute('data-answer')) {
                        score++;
                        break;
                    }
                }
            }

            // Calculate the percentage
            let percentage = (score / totalQuestions) * 100;
            
            // Collect selected options and question IDs
            let selectedOptions = [];
            for (let i = 0; i < totalQuestions; i++) {
                let userAnswer = document.querySelector(`input[name="box${i}"]:checked`);
                let questionId = document.querySelector(`input[name="box${i}"]`).dataset.questionId;
                selectedOptions.push({
                    questionId: questionId,
                    option: userAnswer ? userAnswer.value : null,
                });
            }


            // Send data to the server
            sendDataOnSave(selectedOptions, score, percentage);

            // Show the test save modal
            var saveTestModal = new bootstrap.Modal(document.getElementById('saveTestModal'));
            saveTestModal.show();
        }


        function sendDataOnSave(selectedOptions, score, percentage) {
            const serverUrl = '/student/assessment/assigned/questions/<%- JSON.stringify(data0[0].test_id) %>/<%-class_id%>/<%-assigned_questions_id%>/save-test';
            console.log("class_id",`<%-JSON.stringify(data0[0].class_id)%>`);
            console.log("test_id",`<%-JSON.stringify(data0[0].test_id)%>`);

            
            fetch(serverUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    options: selectedOptions,
                    score: score,
                    percentage: percentage,
                }),
            })
            .then((response) => response.json())
            .then((data) => {
                console.log('Success:', data);
            })
            .catch((error) => {
                console.error('Error:', error);
            });
        }       

        function ShowAndHide() {
            var x = document.getElementById('answer');
            if (x.className == 'inv') {
                x.className = 'vis';
                highlightCorrectAnswers();
            } else {
                x.className = 'inv';
            }
        }
    
        function highlightCorrectAnswers() {
            const totalQuestions = `<%- JSON.stringify(data0.length) %>`;

            for (let i = 0; i < totalQuestions; i++) {
                let correctAnswer = document.querySelector(`input[name="box${i}"][value="${document.querySelector(`input[name="box${i}"]`).dataset.answer}"]`);
                let selectedAnswer = document.querySelector(`input[name="box${i}"]:checked`);
        
                if (correctAnswer) {
                    let correctAnswerLabel = document.querySelector(`label[for="${correctAnswer.id}"]`);
                    correctAnswerLabel.classList.add("correct");
                }
        
                if (selectedAnswer) {
                    let selectedAnswerLabel = document.querySelector(`label[for="${selectedAnswer.id}"]`);
                    selectedAnswerLabel.classList.add(selectedAnswer === correctAnswer ? "correct" : "wrong");
                }
            }
        }

    </script>

 
   
    <br><br><br>
    <div style="flex-grow:1"></div>
    <%- include('t_footer.ejs') %>
</body>



</html>